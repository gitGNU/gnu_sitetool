#! @PERL@

#
# NEWS-query.in
#
# Copyright (C) 2007, 2008 Francesco Salvestrini
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License along
# with this program; if not, write to the Free Software Foundation, Inc.,
# 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
#

use strict;
use warnings;

my $program = "NEWS-query";

my $filename;
my $index;

if ($#ARGV < 0) {
    print STDERR "$program: Missing parameters\n";
    exit 1;
}
if ($#ARGV > 1) {
    print STDERR "$program: too many parameters\n";
    exit 1;
}

$filename = $ARGV[0];
$index    = $ARGV[1];

my $filehandle;

if (!open($filehandle, "<", $filename)) {
    print STDERR "Unable to open \`$filename' for reading ($!)\n";
    exit 1;
}

my @tags= ();
while (<$filehandle>) {
    my $line;

    $line = $_;
    chomp($line);

    if ($line =~ /^[ \t]*([0-9]+\.[0-9]+\.[0-9]+):.*$/) {
	push(@tags, $1);
    }
}
close($filehandle);

if (defined($index)) {
    if (($index < ($#ARGV - 1)) || ($index > $#ARGV)) {
	print STDERR "Index is out of range [0 .. " . $#ARGV. "]\n";
	exit 1;    
    }

    print "$tags[$index]\n";
} else {
    print "@tags\n";
}

exit 0;
